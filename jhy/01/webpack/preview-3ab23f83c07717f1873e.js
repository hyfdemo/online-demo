webpackJsonp([16],{AcyE:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,o){try{var i=t[r](o),c=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(c).then(function(e){a("next",e)},function(e){a("throw",e)});e(c)}return a("next")})}}function h(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,o){try{var i=t[r](o),c=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(c).then(function(e){a("next",e)},function(e){a("throw",e)});e(c)}return a("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("AxSz"),m=n("sn4q"),p=n("0oll"),d=n("6QCI"),w=n("1C3V"),f=n("iNpB"),b=n("E7xn"),g=n("GiK3"),_=n.n(g),x=n("O27J"),v=n.n(x),k=n("KSGD"),y=n("UZ4Z"),z=n.n(y),N="/images/sharing/wechat_"+window.MBLocale+".png",E="/images/sharing/ios_"+window.MBLocale+".png",M=function(e){function t(){var n,o,i;a(this,t);for(var c=arguments.length,s=Array(c),l=0;l<c;l++)s[l]=arguments[l];return n=o=r(this,e.call.apply(e,[this].concat(s))),o.handleClick=function(){o.props.onClose()},i=n,r(o,i)}return o(t,e),t.prototype.render=function(){var e=this.props.show,t=MB.isWechat(),n=!t&&MB.isIOS(),a=!(t||n),r={display:e?"":"none"};return _.a.createElement("div",{className:z.a.covers,style:r,onClick:this.handleClick},t&&_.a.createElement("div",{className:"cover wechat"},_.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),_.a.createElement("img",{className:"tips",src:N}),_.a.createElement("div",{className:"arrow"})),n&&_.a.createElement("div",{className:"cover ios"},_.a.createElement("img",{className:"robot",src:"/images/sharing/robot.png"}),_.a.createElement("img",{className:"tips",src:E}),_.a.createElement("div",{className:"arrow"})),a&&_.a.createElement("div",{className:"cover building"},_.a.createElement("div",{className:"tip-wrapper"},_.a.createElement("p",{className:"tip"},I18N.building_apk),_.a.createElement("div",{className:"spinner"}))))},t}(g.PureComponent),I=M;M.propTypes={show:k.PropTypes.bool,onClose:k.PropTypes.func};var j=n("mMr3"),S=n.n(j),C=n("T2Un"),P=n.n(C),B=n("vLgD"),T=this,O=P.a.bind(S.a),D=function(){var e=l(regeneratorRuntime.mark(function e(t){var n,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(B.a)("/app/"+t+"/build/apk.json",null,{method:"PUT"});case 2:return e.next=5,R(5e3);case 5:return e.next=7,Object(B.a)("/app/"+t+"/status/apk.json");case 7:if(n=e.sent,a=n.progress,r=n.link,100===a){e.next=12;break}return e.abrupt("continue",2);case 12:return window.location=r,e.abrupt("return");case 16:case"end":return e.stop()}},e,T)}));return function(t){return e.apply(this,arguments)}}(),R=function(e){return new Promise(function(t){return setTimeout(t,e)})},A=function(e,t){var n=window.location,a=n.hostname,r=n.pathname,o=navigator.userAgent.toLowerCase(),i=document.createElement("iframe");if(document.body.appendChild(i),i.style.cssText="display:none;width=0;height=0",setTimeout(function(){window.location=e},200),console.log("userAgent",o),o.includes("chrome")&&o.includes("android")&&!o.includes("ucbrowser")&&!o.includes("quark")){var c="intent://"+a+r+"?password="+t+"#Intent;package=com.mockingbot;scheme=mockingbot;S.browser_fallback_url="+e+";end";i.src=c}else{var s="mockingbot://"+a+r+"?password="+t;window.open(s)}},L=function(e,t){var n=window.location,a="modao://"+n.hostname+n.pathname+"?password="+t;setTimeout(function(){window.location=e},25),window.location=a},U=function(e){function t(){i(this,t);var n=c(this,e.call(this));return n.handleView=function(e){e.preventDefault(),n.props.loadProject()},n.handleInstall=function(e){e.preventDefault();var t=n.props.project,a=t.accessToken,r=t.userPlan,o=t.exportable;MB.isWechat()?n.setState({isCoverShow:!0}):MB.isiPad()||MB.isIOS()?n.setState({isCoverShow:!0}):o?(n.setState({isCoverShow:!0}),D(a).then(function(){return n.setState({isCoverShow:!1})}).catch(function(e){})):MB.promptRenew("exportable",{format:"apk",role:"project",plan:r})},n.handleDownload=function(e){var t=n.props.encryptedPassword;MB.isWechat()?n.setState({isCoverShow:!0}):MB.isIOS()?L(e,t):MB.isAndroid()&&A(e,t)},n.handleCloseCover=function(){n.setState({isCoverShow:!1})},n.state={isCoverShow:!1},n}return s(t,e),t.prototype.componentDidMount=function(){$("#splash").hide(),$("#workspace").show(),$.timeago.settings.lang=window.MBLocale,$(".timeago").timeago()},t.prototype.render=function(){var e=this,t=this.props.project,n=t.name,a=t.iconUrl,r=t.updatedAt,o=t.ios_client_url,i=t.android_client_url,c=this.state.isCoverShow,s=MB.isAndroid(),l=s?i:o,h=s?I18N.download_android_apk:I18N.add_to_home_screen;return _.a.createElement("div",{className:O("install-page",{"is-wechat":MB.isWechat()})},_.a.createElement("div",{className:"app-inner"},_.a.createElement("img",{className:"app-icon",src:a}),_.a.createElement("h1",{className:"app-name"},n),_.a.createElement("div",{className:"app-update-time"},_.a.createElement("time",{className:"timeago",dateTime:r}),I18N.update),_.a.createElement("div",{className:"install-btns"},_.a.createElement("a",{className:"install-btn primary",onClick:function(){return e.handleDownload(l)}},I18N.open_in_client),_.a.createElement("a",{className:"install-btn",onClick:this.handleView},I18N.view_app)),_.a.createElement("a",{className:"download-btn",onClick:this.handleInstall},_.a.createElement("span",null,h),_.a.createElement("i",{className:"fa fa-angle-right"}))),_.a.createElement(I,{show:c,onClose:this.handleCloseCover}))},t}(g.PureComponent);U.propTypes={project:k.PropTypes.object,loadProject:k.PropTypes.func,encryptedPassword:k.PropTypes.string};var W=U,q=this,F=window,Z=F.$,J=F.MB,V=F.md5,G=F.Pusher,K=F.AutoSaver,Q=F.SharingRunner;J.f.inSharing=!0,J.load=function(){var e=h(regeneratorRuntime.mark(function e(t,n,a,r,o){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(J.supportedBrowser()){e.next=4;break}return Z("#splash").hide(),Z("#loading").hide(),e.abrupt("return");case 4:if(!r){e.next=11;break}return e.next=7,Y(t,n,a,window.MBData?te:ee);case 7:return Z("#loading").hide(),a=a||J.localStorageDelegate[t+"_pwd"],e.next=11,new Promise(function(e){v.a.render(_.a.createElement(W,{project:o,loadProject:e,encryptedPassword:a}),document.getElementById("workspace"))});case 11:return e.next=13,Y(t,n,a,window.MBData?te:X);case 13:i=e.sent,window.MBData?ae(i):ne(i);case 15:case"end":return e.stop()}},e,q)}));return function(t,n,a,r,o){return e.apply(this,arguments)}}();var Y=function(){var e=h(regeneratorRuntime.mark(function e(t,n,a,r){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0,e.prev=1,a=a||J.localStorageDelegate[t+"_pwd"],e.next=5,r(t,a);case 5:o=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0),J.localStorageDelegate.removeItem(t+"_pwd");case 12:if(o){e.next=25;break}return e.prev=13,a=V(prompt(I18N.credential_required)),e.next=17,r(t,a);case 17:o=e.sent,e.next=25;break;case 20:throw e.prev=20,e.t1=e.catch(13),console.log(e.t1),alert(n?I18N.invalid_credential:"Failed to load this App."),e.t1;case 25:return n&&(J.localStorageDelegate[t+"_pwd"]=a),e.abrupt("return",o);case 27:case"end":return e.stop()}},e,q,[[1,8],[13,20]])}));return function(t,n,a,r){return e.apply(this,arguments)}}(),H=function(e){return new Promise(function(t,n){return Z.getJSON(e,function(e){return t(e)}).fail(function(e,t,a){return n(a)})})},X=function(){var e=h(regeneratorRuntime.mark(function e(t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="/app/"+t+".json?"+(new Date).valueOf()+(n?"&password="+n:""),e.abrupt("return",H(a));case 2:case"end":return e.stop()}},e,q)}));return function(t,n){return e.apply(this,arguments)}}(),ee=function(){var e=h(regeneratorRuntime.mark(function e(t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/app/"+t+"/checkpassword?password="+n);case 2:if((a=e.sent).ok){e.next=5;break}throw new Error("Wrong password!");case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}},e,q)}));return function(t,n){return e.apply(this,arguments)}}(),te=function(){var e=h(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.MBData.project.password||n===window.MBData.project.password){e.next=2;break}throw new Error("Local password invalid");case 2:return e.abrupt("return",window.MBData);case 3:case"end":return e.stop()}},e,q)}));return function(t,n){return e.apply(this,arguments)}}(),ne=function(e){Z(".indicator").css("height","100%"),setTimeout(function(){return re(e)},300)},ae=function(e){J.staticMap=function(){return"images/workspace/staticmap_"+window.MBLocale+".png"},e.project.splash="images/splash.png",e.screens.forEach(function(e){e.bgimage&&(e.bgimage=e.bgimage.replace(/^.+uploads.*?\//,""))}),e.widgets.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),e.widgetstates.forEach(function(e){e.image&&(e.image=e.image.replace(/^.+uploads.*?\//,""))}),Z(".indicator").css("height","100%"),setTimeout(function(){return re(e)},300)},re=function(e){J.DEVICES=e.devices;var t=e.project.template?new Template:e.project.combo?new Combo:new Project;t.load(e.project),t.lsave(!1),Template.refresh(e.templates),Screen.refresh(e.screens),Widget.refresh(e.widgets),Link.refresh(e.links),Panel.refresh(e.panels),Screenstate.refresh(e.screenstates),Widgetstate.refresh(e.widgetstates),Panelstate.refresh(e.panelstates),Collaborator.refresh(e.collaborators),CommentThread.refresh(e.threads),Comment.refresh(e.comments),Team.refresh(e.teams),J.user=Z("#workspace").data("user")||{},J.user.id&&(J.pusher=new G,J.pusher.subscribe(t.cid)),J.isMobile()||(J.autoSaver=new K),(new Image).src=J.staticMap(),Z("title").html(t.name),Z("#loading").hide(),!t.validated&&J.isMobile()&&J.alert({title:I18N.reminder,desc:I18N.fraud_warning,confirmText:I18N.fraud_confirm,isHTML:!0}),J.checkFA(function(){Z(".box").hide(),J.currentProject=t,J.webpackInterface.init(),J.runner=new Q(t),J.runner.render()})};n("EF4r"),n("bjzn"),n("aTD+"),n("1/YY"),n("lI4/");MB.COMPONENTS=b.b;try{u.a.MB.webpackInterface=Object(m.a)(p.a),u.a.MB.setRunnerExtra=d.a,u.a.MB.renewMsg=f.a,u.a.MB.promptRenew=f.c,u.a.MB.messageBucket=Object(w.a)(w.b)}catch(e){console.warn("[UI:Preview] Failed to init:",e.stack||e)}},E7xn:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var a=[{name:"label",icon_text:"文字",text:I18N.w.label,tb_text:"文字",icon_name:"text",width:33,height:23,fs:14,br:0,bs:0,ha:"center",va:"middle",z:5,lh:1.45},{name:"text_view",icon_text:"多行文字",text:I18N.w.text_view_placeholder,tb_text:"多行文字",icon_name:"paragraph",width:200,height:65,fs:14,br:0,bs:0,ha:"left",va:"top",z:5,lh:1.45},{name:"rounded_rect",icon_text:"矩形",text:"",icon_name:"rectangle",width:200,height:100,br:0,bs:1,fs:14,ha:"center",va:"middle",lh:1.45,z:5},{name:"circle_rect",icon_text:"圆形",text:"",icon_name:"circle",width:100,height:100,br:100,bs:1,fs:14,ha:"center",va:"middle",lh:1.45,z:5},{name:"triangleb",icon_text:"三角",text:"",icon_name:"triangle-top",width:40,height:30,z:5},{name:"triangletl",icon_text:"三角",text:"",icon_name:"triangle-left-bottom",width:40,height:40,z:5},{name:"hr",icon_text:"线条",text:"",icon_name:"horizontal-line",width:150,height:10,z:5,zoomable:"w,e,n"},{name:"ve",icon_text:"线条",text:"",icon_name:"vertical-line",width:10,height:150,z:5,zoomable:"n,s,w"},{name:"button",icon_text:"按钮",text:I18N.w.button,tb_text:"按钮",icon_name:"btn",width:80,height:30,fs:14,br:4,bs:1,ha:"center",va:"middle",z:5,icon:"",is:14},{name:"image_view",icon_text:"图片",text:"",icon_name:"img",width:200,height:120,br:0,bs:0,z:5},{name:"icon_button",icon_text:"图标",text:"",icon:"star",icon_name:"smile",width:24,height:24,br:0,bs:0,is:24,z:5},{name:"tab_item",icon_text:"标签",text:I18N.w.tab_item,tb_text:"标签",icon_name:"icon-label",icon:"home",width:80,height:45,fs:12,is:24,z:5,ha:"center",zoomable:"w,e"},{name:"lr",icon_text:"链接区域",tb_text:"链接区域",icon_name:"link",width:45,height:45,br:0,bs:0,z:7},{icon_text:"网页",name:"webpage",text:"about:blank",tb_text:"网页",icon_name:"webpage",width:"100%",height:400,z:5,ha:"center"},{name:"pg",icon_text:"全局手势",icon_name:"gesture",icon:"tap",width:40,height:40,br:0,bs:0,z:7,zoomable:" "},{name:"sticky",icon_text:"批注",tb_text:"批注",icon_name:"sticker",width:204,height:170,padding:24,fs:12,lh:1.67,z:10},{name:"mtext_input",icon_text:"单行输入",text:I18N.w.mtext_input,tb_text:"单行输入",icon_name:"input",width:200,height:30,fs:14,br:0,bs:1,ha:"left",va:"middle",z:5,padding:8},{name:"mtextarea",icon_text:"多行输入",text:I18N.w.mtextarea,tb_text:"多行输入",icon_name:"textarea",width:280,height:100,fs:14,lh:1.45,br:0,bs:1,ha:"left",z:5,padding:8},{name:"mselect",icon_text:"下拉框",text:"1\n2\n3",tb_text:"下拉框",icon_name:"select",width:200,height:30,fs:14,bs:1,z:5,lh:1.45,padding:8},{name:"mfile_input",icon_text:"选择文件",tb_text:"文件选择",icon_name:"file",width:200,height:30,z:5,padding:8},{name:"mtooltip",icon_text:"聊天气泡",text:I18N.w.mtooltip,tb_text:"聊天气泡",icon_name:"tooltip",width:220,height:40,fs:14,br:5,ha:"left",va:"top",z:5,lh:1.45,bg:"#8DFA69",bc:"#5FE163",bs:1,padding:10},{name:"map_view",icon_text:"地图",text:"",icon_name:"map",width:"100%",height:230,z:4},{name:"mcheckbox2",icon_text:"复选框",icon_name:"checkbox",width:30,height:30,z:5,checked:!1},{name:"mradiobutton",icon_text:"单选框",icon_name:"radio",width:30,height:30,z:5,checked:!1},{name:"ios_check",icon_text:"多选框",width:22,height:22,z:5,zoomable:" ",checked:!0},{name:"android_check",icon_text:"多选框",width:18,height:18,z:5,zoomable:" ",checked:!0},{name:"android_radio",icon_text:"单选框",width:20,height:20,z:5,zoomable:" ",checked:!1},{name:"switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:50,height:30,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"ios_switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:50,height:30,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"android_switch",icon_text:"开关按钮",text:"",icon_name:"toggle",width:37,height:20,br:0,bs:0,z:5,zoomable:" ",checked:!0},{name:"navigation_bar",icon_text:"标题栏",text:I18N.w.navbar_title,tb_text:"标题栏",icon_name:"header",width:"100%",height:55,fs:18,z:4,zoomable:"s",ha:"center",top:23},{name:"tab_bar",icon_text:"底栏",text:"",tb_text:"底栏",icon_name:"footer",width:"100%",height:45,z:4,zoomable:"n"},{name:"rectangle",icon_text:"空白通栏",text:"",icon_name:"bar",width:"100%",height:100,z:5,zoomable:"n,s"},{name:"search_bar",icon_text:"搜索框",text:I18N.w.search,tb_text:"搜索",icon_name:"search-input",width:"100%",height:45,fs:14,ha:"left",z:5,zoomable:"w,e"},{name:"keyboard",icon_text:"键盘",text:I18N.w.return,width:"100%",icon_name:"keyboard",z:3,zoomable:" ",numeric:!1},{name:"status_bar",icon_text:"状态栏",text:I18N.w.carrier,tb_text:"中国移动",icon_name:"battery",width:"100%",height:23,z:3,zoomable:" "}],r=a.reduce(function(e,t){return e[t.name]=t,e},{})},UZ4Z:function(e,t){e.exports={covers:"_2fva7dqNrMTA3qQj2Sag2u"}},mMr3:function(e,t){e.exports={"install-page":"_1ucR52TRm2uhcZJhUjsxqG"}}},["AcyE"]);
//# sourceMappingURL=preview-3ab23f83c07717f1873e.js.map